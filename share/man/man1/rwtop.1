.\" $Header$
.\" vim:ts=4:sw=4:syntax=nroff
.fp 1 R
.fp 2 I
.fp 3 B
.fp 4 BI
.fp 5 R
.fp 6 B
.fp 7 I
.nr X
.TH rwtop 1 "04 Jun 2001" ""
.SH NAME
rwtop \- print value of RapidWiz installed path
.SH SYNOPSIS
\f3rwtop\f1 [\f3-1\f1][\f3-v\f1] [\f3-sun\f1][\f3-i\f1|\f3\-f\f2file\f1|\f3-p\f2pattern\f1...] {\f3appl\f1|\f3inst\f1|\f3db\f1} \f2s_systemname\f1
.SH DESCRIPTION
.IX "rwtop"
The \f3rwtop\f1 command 
is useful to employ in shell scripts where the value for a particular
path for one of the directories created by RapidWiz needs to be printed.
The path printed is that for the installation associated with \f2s_systemname\f1.
.P
The directory to be printed is determined by the value of the first
argument:
.RS
.TP
\f3inst\f1
Print the value for \f5INST_TOP\f1 (R12 installations only).
.TP
\f3db\f1
Print the value for \f5DB_TOP\f1.
.TP
\f3appl\f1
Print the value for \f5APPL_TOP\f1 (superseded by INST_TOP for R12+).
.RE
.P
\f3rwtop\f1 operates in one of two modes depending on the information
found and the options specified.
.P
The first mode - the usual - is a
"pattern search" where the required directory is searched by matching
against a known shell pattern or patterns.
.P
The second mode is a facility that allows paths to be explicitly set in a
lookup file - this may be useful to minimise the search time taken to
determine the path or to specify paths for an \f2s_systemname\f1 that does not
conform to some common naming strategy.
.SS Pattern Search
.P
\f3rwtop\f1 searches for directory paths which match a known shell
pattern. For example, in the instance where the value for s_systemname is "TST":
.P
.RS
\f5/u[0-9][0-9]/oracle/\f2tst\fPinst\f1
.RE
.P
This is used to generate the path for the directory being examined
for the directory type in question.
.P
The keywords ${s_systemname} and ${oracle_sid} can be used in these 
patterns to represent, respectively,
the value for the \f2s_systemname\fP in upper and lower case.
.P
Additionally, the keyword ${ctx} can also be use to refer to the "context
name" of the installation. The context name (in Korn shell notation) is usually
${s_systemname}_$(hostname). In searching for possible paths all possible
candidate contexts are generated and evaluated since the system may be known
by multiple names (network interfaces) and the name of the host used by the
context might not necessarily be the one set by
.BR hostname (1).
.P
For example, using the previous pattern - the search for COMMON_TOP for
\f2s_systemname\f1 would be:
.P
.RS
\f5/u[0-9][0-9]/oracle/${oracle_sid}inst\f1
.RE
.P
It is an error, since it is an invalid RapidWiz configuration, if
multiple matches are returned.
.S3 Pattern File
.P
If neither \f3-f\f1 or \f3-p\f1 are specified, \f3rwtop\f1 examines
the file \f5/etcBASEDIR/rwpat\f1 for a list of patterns.
.P
The format of the pattern file \f5/etcBASEDIR/rwpat\f1 (or for the pattern
file supplied with the \f3-f\f1 option) is:
.RS
\f2type\f1\(sq\f2pattern\f1
.RE
.P
Where \(sq is any sequence of whitespace (excluding newline.)
.P 
Values for \f2type\f1 are those described in "Explicit Path" below.
.P
Note that every pattern (of the specified type), irrespective of 
how \f3rwtop\f1 was invoked, will be searched for a match.
Multiple matches will yield an error.
.P
If \f3-f\f1 has not been specified and the default file does not exist then
internal defaults are used. 
.SS Explicit Path
.P
Values for \f5APPL_TOP\f1, \f5INST_TOP\f1, and \f5DB_TOP\f1
can be explicitly set in the lookup file \f5/etcBASEDIR/rwtop\f1, for
example, if the locations do not match any of the methods
of specifying a pattern for a path search, that is, the path is
not a variant of that which would ordinarily be generated by
RapidWiz. If the \f3-p\f1, \f3-i\f1 or \f3-f\f1 options are used
this file will not be searched.
.S3 Path File
.P
The format of this file is:
.P
.RS
\f4s_systemname\(sqtype\(sq\f2path\f1
.RE
.P
Note that \f2path\f1 must be a readable pathname (unless the \f3-s\f1
option is used.) No shell filename expansion will be performed on
\f2path\f1. Each entry is separated by a newline, fields in each record
are separated by whitespace. Comments may start a line with '#'.
.P
\f4type\f1 is one of:
.RS
.IP \(bu
\f5APPL_TOP\f1
.IP \(bu
\f5INST_TOP\f1
.IP \(bu
\f5DB_TOP\f1
.RE
.P
The effect of the presence of an entry for a given \f2s_systemname\f1 is to
override the pattern matching process, that is, if a valid entry is
found in the file \f5/etcBASEDIR/rwtop\f1 for \f2s_systemname\f1 it will be
returned.
.P
If an entry is not found (or an entry is found but the
path does not exist and the \f3-s\f1 option has not been used) \f3rwtop\f1
will continue in pattern matching mode.
.P
If multiple entries for the same \f4s_systemname type\f1 pair are present in the
file \f5/etcBASEDIR/rwtop\f1 then only the first one found will be used.
If the \f3-u\f1 option is used to update this file then any such duplicate 
entries for this key pair will be purged.
.SH OPTIONS
.TP
\f3\-1\f1
Ordinarily, if multiple paths 
are found an error is returned. This option overrides this behaviour to return
the first path found.
.TP
\f3\-v\f1
Verify that the path (in the case of \f5APPL_TOP\f1, \f5INST_TOP\f1,
or \f5DB_TOP\f1)
is valid, that is, containing a known file expected to exist.) If multiple paths
exist the first valid one found will be returned irrespective of whether the \f3-1\f1 option is used.
.TP
\f3\-s\f1
If an explicit path has been set and no such directory
exists, this option silently ignores this error and returns the value
anyway. This option has no effect if \f3-f\f1 or \f3-p\f1 are used.
.TP
\f3\-u\f1
Update the lookup file with a successfully matched value.
Has no effect if the value was obtained from the lookup file.
.TP
\f3\-n\f1
Normally, \f3rwtop\f1 will try to resolve paths. A resolved path
is one that does not involve ".", "..", multiple directories - "//" 
or symbolic links. Use of \f3-n\f1 suppresses resolution of
paths.
.TP
\f3\-i\f1
Ignore the entries in the file \f5/etcBASEDIR/rwtop\f1,
should it exist, and use the default patterns in the file
\f5/etcBASEDIR/rwpat\f1, or if this file does not exist, the
internal patterns.
.TP
\f3\-f \f2file\f1
\f2file\f1 is a file containing shell patterns as
described under the \f3-p\f1 option.  Each pattern must be separated by
whitespace (space, tab or newline.) No quoting of metacharacters is
required.
.TP
\f3\-p \f2pattern\f1
\f2pattern\f1 is a shell pattern in the style of
.BR sh (1)
and is used for matching the dirname. Multiple values of \f3-p\f1 can
be specified. Patterns containing shell meta-characters must be escaped
from the shell to prevent premature evaluation. For example:
.P
.RS
\f5rwtop -p \'/[du][0-9][0-9]/app/*\' inst SID\f1
.RE
.SH AUTHOR
Simon Anthony (santhony@me.com)
.SH FILES
.PD 0
.TP 30
\f5/etcBASEDIR/rwpat\f1
Patterns to use for dirname prefix match.
.TP 30
\f5/etcBASEDIR/rwtop\f1
Explicitly set values for \f5TOP\f1s.
.PD
.SH "SEE ALSO"
.BR sh (1),
.BR fnmatch (3C),
.BR glob (3C),
.BR realpath (3C),
.BR gmatch (3G)
.SH DIAGNOSTICS
.IP  0  10
Success.
.IP  1  10
Cannot open a specified file. More than one directory matches the pattern.
.IP  2  10
Invalid command syntax.  Usage message of the \f3rwtop\f1 command is 
displayed. Cannot access path specified in \f5/etcBASEDIR/rwtop\f1.
